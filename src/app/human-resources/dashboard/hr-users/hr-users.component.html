<div class="hr-app-container">
    <!-- Sidebar with user list -->
    <div class="users-sidebar">
      <div class="search-container">
        <input 
          type="text" 
          [formControl]="searchControl" 
          placeholder="Search users..."
          class="search-input"
        >
      </div>
      
      <div class="users-container">
        <div 
          *ngFor="let user of filteredUsers" 
          class="user-item" 
          [class.active]="selectedUser?.id === user.id"
          (click)="selectUser(user.id)"
        >
          <div class="user-avatar">
            {{ getInitials(user.name) }}
          </div>
          <div class="user-info">
            <h3>{{ user.name }}</h3>
            <p>{{ user.department }}</p>
            <span class="note-count">{{ user.noteCount }} {{ user.noteCount === 1 ? 'course' : 'courses' }}</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Main content area -->
    <div class="main-content">
      <!-- User profile header -->
      <div class="user-profile-header" *ngIf="selectedUser">
        <div class="user-details">
          <div class="user-avatar large">
            {{ getInitials(selectedUser.name) }}
          </div>
          <div>
            <h1>{{ selectedUser.name }}</h1>
            <p>{{ selectedUser.department }} - Employee</p>
          </div>
        </div>
        <!-- Removed Add QCM button as requested -->
      </div>
      
      <!-- Course performance section -->
      <div class="notes-section">
        <div *ngIf="loadingNotes" class="loading-notes">
          Loading course results...
        </div>
        
        <div *ngIf="!loadingNotes" class="notes-container">
          <div *ngFor="let note of currentNotes" class="note-card" [class.new-note]="note.id === currentNoteId">
            <div class="note-header">
              <h3>{{ note.title }}</h3>
              <div class="note-actions">
                <button class="btn-icon edit-btn" title="Add feedback" (click)="openEditNoteModal(note)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn-icon delete-btn" title="Delete record" (click)="deleteNote(note.id)">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
            <div class="note-content">
              <p><strong>Score: {{ note.content }}</strong></p>
            </div>
            <div class="note-footer">
              <div class="note-tags">
                <span *ngFor="let tag of note.tags" class="tag">{{ tag }}</span>
              </div>
              <div class="note-date">
                <i class="fas fa-calendar-alt"></i> {{ formatDate(note.createdDate) }}
              </div>
            </div>
          </div>
          
          <div *ngIf="currentNotes.length === 0 && !loadingNotes" class="no-notes">
            No course results found for this user.
          </div>
        </div>
      </div>
    </div>
    
    <!-- Feedback modal -->
    <div id="note-modal" class="modal" [class.visible]="isModalVisible">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Add Feedback for {{ isEditMode ? note?.title : 'Course' }}</h2>
          <button class="close-btn" (click)="closeNoteModal()">Ã—</button>
        </div>
        
        <form [formGroup]="noteForm" (ngSubmit)="addNote()">
          <div class="form-group">
            <label for="note-title">Course:</label>
            <input 
              type="text" 
              id="note-title" 
              formControlName="title" 
              placeholder="JavaScript Course, SQL Course, etc."
              [readonly]="isEditMode"
            >
            <div *ngIf="noteForm.get('title')?.invalid && noteForm.get('title')?.touched" class="error-message">
              Course name is required
            </div>
          </div>
          
          <div class="form-group">
            <label for="note-content">Performance Score (%):</label>
            <input 
              type="text" 
              id="note-content" 
              formControlName="content" 
              placeholder="e.g. 85%, 70%, etc."
            >
            <div *ngIf="noteForm.get('content')?.invalid && noteForm.get('content')?.touched" class="error-message">
              Score is required
            </div>
          </div>
          
          <div class="form-group">
            <label for="note-tags">Categories (comma separated):</label>
            <input 
              type="text" 
              id="note-tags" 
              formControlName="tags" 
              placeholder="e.g. technical, frontend, database"
            >
          </div>
          
          <div class="form-actions">
            <button type="button" id="cancel-note" (click)="closeNoteModal()">Cancel</button>
            <button type="submit" id="save-note" [disabled]="noteForm.invalid">
              {{ isEditMode ? 'Update Record' : 'Save Record' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>